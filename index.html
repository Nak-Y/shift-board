<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShiftBoard</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Shippori+Mincho:wght@600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{background:#f5f0ea;color:#4a3f35;font-family:'Zen Maru Gothic','Hiragino Kaku Gothic ProN',sans-serif;min-height:100vh;}
button{font-family:inherit;cursor:pointer;}
input,select,textarea{font-family:inherit;}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-thumb{background:#d4c0b0;border-radius:3px;}
.modal-overlay{position:fixed;inset:0;background:rgba(74,63,53,0.4);backdrop-filter:blur(3px);z-index:100;display:flex;align-items:center;justify-content:center;padding:16px;}
.modal{background:#fff9f5;border-radius:20px;padding:24px;width:100%;max-width:640px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(74,63,53,0.2);}
@media print{.no-print{display:none!important;}body{background:#fff;}}
</style>
</head>
<body>
<div id="root"></div>
<script>
const {useState,useEffect,useRef,useCallback,useMemo}=React;

// ==================== è¨­å®š ====================
const ADMIN_PW = "admin1234";
const TIME_START = 10; // 10æ™‚
const TIME_END = 18;   // 18æ™‚
const SLOTS = [];
for(let h=TIME_START;h<TIME_END;h++){SLOTS.push(`${h}:00`);SLOTS.push(`${h}:30`);}
// ["10:00","10:30","11:00",...,"17:30"] 16ã‚³ãƒ

// ==================== ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ====================
const S={
  get:(k)=>{try{const v=localStorage.getItem(k);return v!=null?JSON.parse(v):null;}catch{return null;}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v));}catch{}},
};

// ==================== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ====================
function pad(n){return String(n).padStart(2,"0");}
function mkey(y,m){return `${y}-${pad(m+1)}`;}
function dkey(y,m,d){return `${y}-${pad(m+1)}-${pad(d)}`;}
function getDays(year,month,holidays={}){
  const count=new Date(year,month+1,0).getDate();
  return Array.from({length:count},(_,i)=>{
    const d=new Date(year,month,i+1);
    const w=d.getDay();
    const dk=dkey(year,month,i+1);
    const isWE=w===0||w===6;
    const hname=holidays[dk]||null;
    return{day:i+1,wd:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][w],isWE,isHoliday:!!hname,holidayName:hname,isRed:isWE||!!hname,dk};
  });
}
function slotToMinutes(slot){const[h,m]=slot.split(":").map(Number);return h*60+m;}
function calcHours(startSlot,endSlot){
  if(!startSlot||!endSlot)return 0;
  const diff=slotToMinutes(endSlot)-slotToMinutes(startSlot);
  return diff>0?diff/60:0;
}

// ç¥æ—¥å–å¾—
const holCache={};
async function fetchHolidays(year){
  if(holCache[year])return holCache[year];
  try{const r=await fetch(`https://holidays-jp.github.io/api/v1/${year}/date.json`);if(!r.ok)return{};const d=await r.json();holCache[year]=d;return d;}
  catch{return{};}
}

// ==================== ã‚«ãƒ©ãƒ¼ ====================
const C={
  bg:"#f5f0ea",card:"#fff9f5",border:"#e8ddd4",
  text:"#4a3f35",muted:"#a08878",faint:"#c9b9a8",
  primary:"#b07d62",primaryLight:"#b07d6222",
  accent:"#8c7aaa",accentLight:"#8c7aaa22",
  sage:"#7a9e87",sageLight:"#7a9e8722",
  rose:"#c47a7a",roseLight:"#c47a7a22",
  amber:"#c4956a",amberLight:"#c4956a22",
  red:"#c47a7a",
  shortfall:"#fde8e8", // ä¸è¶³æ—¥èƒŒæ™¯
  weekend:"#fdf0ee",
};
const F="'Zen Maru Gothic','Hiragino Kaku Gothic ProN',sans-serif";

function btn(bg=C.primary,ghost=false,sm=false){
  return{padding:sm?"3px 10px":"8px 18px",borderRadius:20,border:ghost?`1.5px solid ${bg}`:"none",
    background:ghost?"transparent":bg,color:ghost?bg:"#fff",fontWeight:700,fontSize:sm?11:13,
    cursor:"pointer",fontFamily:F,lineHeight:1.4,letterSpacing:"0.02em",transition:"opacity .15s"};
}
const card={background:C.card,border:`1px solid ${C.border}`,borderRadius:16,padding:20,boxShadow:"0 2px 12px rgba(180,150,120,0.07)"};
const inp={background:"#fdf8f3",border:`1px solid ${C.border}`,borderRadius:10,padding:"8px 12px",color:C.text,fontSize:13,fontFamily:F,width:"100%"};
const th={padding:"6px 4px",textAlign:"center",color:C.muted,fontWeight:700,borderBottom:`1px solid ${C.border}`,fontSize:11,whiteSpace:"nowrap"};
const td={padding:"3px 2px",textAlign:"center",borderBottom:`1px solid #f0e8e0`,fontSize:12};

// ==================== ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª ====================
function App(){
  const now=new Date();
  const [mode,setMode]=useState("home");
  const [year,setYear]=useState(now.getMonth()===11?now.getFullYear()+1:now.getFullYear());
  const [month,setMonth]=useState((now.getMonth()+1)%12);
  const [holidays,setHolidays]=useState({});
  const [adminOk,setAdminOk]=useState(false);

  // ãƒ‡ãƒ¼ã‚¿
  const [staffList,setStaffList]=useState(()=>S.get("staffList")||[]);
  // staffList: [{id,name,hourlyWage,targetHours}]
  const [requests,setRequests]=useState({});
  // requests[mkey][staffId][dk] = {start,end} or null
  const [shifts,setShifts]=useState({});
  // shifts[mkey][dk] = {positions:[{name,required}], assigned:{staffId:{position,start,end}}}
  const [published,setPublished]=useState({});
  // published[mkey] = bool
  const [deadline,setDeadline]=useState({});
  // deadline[mkey] = "YYYY-MM-DD"

  const mk=useMemo(()=>mkey(year,month),[year,month]);
  const days=useMemo(()=>getDays(year,month,holidays),[year,month,holidays]);

  // ãƒ­ãƒ¼ãƒ‰
  useEffect(()=>{
    setRequests(S.get("requests")||{});
    setShifts(S.get("shifts")||{});
    setPublished(S.get("published")||{});
    setDeadline(S.get("deadline")||{});
  },[]);

  useEffect(()=>{fetchHolidays(year).then(setHolidays);},[year]);

  // ä¿å­˜ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function saveRequests(v){setRequests(v);S.set("requests",v);}
  function saveShifts(v){setShifts(v);S.set("shifts",v);}
  function savePublished(v){setPublished(v);S.set("published",v);}
  function saveDeadline(v){setDeadline(v);S.set("deadline",v);}
  function saveStaff(v){setStaffList(v);S.set("staffList",v);}

  // å¸Œæœ›æ›´æ–°
  function updateRequest(staffId,dk,val){
    const next={...requests,[mk]:{...(requests[mk]||{}),[staffId]:{...((requests[mk]||{})[staffId]||{}),[dk]:val}}};
    if(!val)delete next[mk][staffId][dk];
    saveRequests(next);
  }
  // ã‚·ãƒ•ãƒˆæ›´æ–°
  function updateShift(dk,val){
    const next={...shifts,[mk]:{...(shifts[mk]||{}),[dk]:val}};
    saveShifts(next);
  }

  // æœˆã®ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿å–å¾—
  const mkShifts=shifts[mk]||{};
  const mkRequests=requests[mk]||{};
  const mkPublished=!!published[mk];
  const mkDeadline=deadline[mk]||"";

  // ä¸è¶³ãƒã‚§ãƒƒã‚¯: ãã®æ—¥ã®assignedæ•° < positionsã®åˆè¨ˆrequired
  function isShortfall(dk){
    const dayShift=mkShifts[dk];
    if(!dayShift||!dayShift.positions||dayShift.positions.length===0)return false;
    const required=dayShift.positions.reduce((s,p)=>s+(p.required||0),0);
    const assigned=Object.keys(dayShift.assigned||{}).length;
    return assigned<required;
  }

  // ã‚¹ã‚¿ãƒƒãƒ•åˆ¥æœˆé–“å‹¤å‹™æ™‚é–“ãƒ»çµ¦ä¸
  function staffMonthStats(staffId){
    let totalHours=0;
    days.forEach(({dk})=>{
      const dayShift=mkShifts[dk];
      if(!dayShift||!dayShift.assigned)return;
      const a=dayShift.assigned[staffId];
      if(a)totalHours+=calcHours(a.start,a.end);
    });
    const staff=staffList.find(s=>s.id===staffId);
    const wage=staff?staff.hourlyWage||0:0;
    return{totalHours,totalPay:Math.floor(totalHours*wage)};
  }

  const props={mode,setMode,year,setYear,month,setMonth,mk,days,holidays,
    staffList,saveStaff,requests:mkRequests,shifts:mkShifts,published:mkPublished,deadline:mkDeadline,
    saveRequests,saveShifts,savePublished,saveDeadline,
    updateRequest,updateShift,isShortfall,staffMonthStats,
    adminOk,setAdminOk};

  if(mode==="home")return React.createElement(Home,props);
  if(mode==="nameInput")return React.createElement(NameInput,props);
  if(mode.startsWith("staff|"))return React.createElement(StaffInput,props);
  if(mode==="adminLogin")return React.createElement(AdminLogin,props);
  if(mode==="admin")return React.createElement(AdminPanel,props);
  if(mode==="view")return React.createElement(PublicView,props);
  return null;
}

// ==================== å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ====================
function MonthNav({year,month,setYear,setMonth,style={}}){
  return React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",...style}},
    React.createElement("span",{style:{fontWeight:800,fontSize:15,fontFamily:"'Shippori Mincho',serif"}},[year,"å¹´",month+1,"æœˆ"]),
    React.createElement("button",{style:btn(C.faint,true,true),onClick:()=>{const d=new Date(year,month-1);setYear(d.getFullYear());setMonth(d.getMonth());}},"â—€"),
    React.createElement("button",{style:btn(C.faint,true,true),onClick:()=>{const d=new Date(year,month+1);setYear(d.getFullYear());setMonth(d.getMonth());}},"â–¶"),
  );
}
function DeadlineBanner({deadline}){
  if(!deadline)return null;
  const diff=Math.ceil((new Date(deadline)-new Date().setHours(0,0,0,0))/86400000);
  const past=diff<0;
  const col=past?C.rose:diff<=3?C.amber:C.sage;
  return React.createElement("div",{style:{padding:"7px 14px",borderRadius:8,background:col+"22",border:`1px solid ${col}44`,fontSize:12,color:col,marginBottom:12}},
    "â° ",past?`ç· åˆ‡è¶…éï¼ˆ${deadline}ï¼‰`:`å¸Œæœ›ç· åˆ‡ï¼š${deadline}ã€€ã‚ã¨${diff}æ—¥`
  );
}
function Wrap({children,style={}}){
  return React.createElement("div",{style:{maxWidth:1100,margin:"0 auto",padding:"16px",...style}},children);
}
function BackBtn({onClick}){
  return React.createElement("button",{style:{...btn(C.faint,true,true),marginBottom:14},onClick},"â† æˆ»ã‚‹");
}

// ==================== HOME ====================
function Home({setMode}){
  return React.createElement("div",{style:{minHeight:"100vh",background:C.bg}},
    React.createElement(Wrap,null,
      React.createElement("div",{style:{textAlign:"center",paddingTop:52,marginBottom:44}},
        React.createElement("div",{style:{fontSize:10,letterSpacing:6,color:C.faint,textTransform:"uppercase",marginBottom:8}},"Shift Management"),
        React.createElement("div",{style:{fontSize:36,fontWeight:600,fontFamily:"'Shippori Mincho',serif",background:`linear-gradient(120deg,${C.primary} 0%,${C.accent} 55%,${C.amber} 100%)`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:4}},"ShiftBoard"),
        React.createElement("div",{style:{fontSize:12,color:C.muted}},"å¸Œæœ›åé›†ã‹ã‚‰çµ¦ä¸ç®¡ç†ã¾ã§"),
      ),
      React.createElement("div",{style:{display:"flex",gap:12,justifyContent:"center",flexWrap:"wrap",marginBottom:36}},
        React.createElement("button",{style:{...btn(C.primary),padding:"12px 28px",fontSize:14},onClick:()=>setMode("nameInput")},"ğŸ“ å¸Œæœ›ã‚’å…¥åŠ›ã™ã‚‹"),
        React.createElement("button",{style:{...btn(C.accent),padding:"12px 28px",fontSize:14},onClick:()=>setMode("view")},"ğŸ“… ã‚·ãƒ•ãƒˆã‚’è¦‹ã‚‹"),
        React.createElement("button",{style:{...btn(C.sage),padding:"12px 28px",fontSize:14},onClick:()=>setMode("adminLogin")},"ğŸ” ç®¡ç†è€…"),
      ),
      React.createElement("div",{style:{...card,fontSize:12,color:C.muted,lineHeight:2.2}},
        "â‘  ã‚¹ã‚¿ãƒƒãƒ•ãŒå¸Œæœ›æ™‚é–“ï¼ˆ30åˆ†åˆ»ã¿ï¼‰ã‚’å…¥åŠ›",React.createElement("br"),
        "â‘¡ ç®¡ç†è€…ãŒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã‚·ãƒ•ãƒˆã‚’ç¢ºå®šãƒ»ãƒã‚¸ã‚·ãƒ§ãƒ³å‰²ã‚Šå½“ã¦",React.createElement("br"),
        "â‘¢ å…¬é–‹å¾Œã€ã‚¹ã‚¿ãƒƒãƒ•ãŒç¢ºèª",React.createElement("br"),
        React.createElement("span",{style:{fontSize:11,color:C.faint}},"â€» ã“ã®URLã‚’LINEã‚°ãƒ«ãƒ¼ãƒ—ã«å…±æœ‰ã—ã¦ãã ã•ã„"),
      )
    )
  );
}

// ==================== NAME INPUT ====================
function NameInput({setMode,staffList,mode}){
  const [input,setInput]=useState("");
  return React.createElement("div",{style:{minHeight:"100vh",background:C.bg}},
    React.createElement(Wrap,null,
      React.createElement(BackBtn,{onClick:()=>setMode("home")}),
      React.createElement("div",{style:card},
        React.createElement("div",{style:{fontWeight:800,fontSize:16,marginBottom:16}},"åå‰ã‚’é¸ã¶"),
        staffList.length>0&&React.createElement("div",{style:{marginBottom:16}},
          React.createElement("div",{style:{fontSize:11,color:C.muted,marginBottom:8}},"ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§"),
          React.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},
            staffList.map(s=>React.createElement("button",{key:s.id,
              style:{...btn(C.primary,false,true),padding:"6px 16px",fontSize:13},
              onClick:()=>setMode("staff|"+s.id)
            },s.name))
          )
        ),
        React.createElement("div",{style:{fontSize:11,color:C.faint}},"â€» åå‰ãŒãªã„å ´åˆã¯ç®¡ç†è€…ã«è¿½åŠ ã‚’ä¾é ¼ã—ã¦ãã ã•ã„")
      )
    )
  );
}

// ==================== STAFF INPUT ====================
function StaffInput(props){
  const {mode,setMode,mk,days,staffList,requests,updateRequest,deadline}=props;
  const staffId=mode.split("|")[1];
  const staff=staffList.find(s=>s.id===staffId);
  const myReq=requests[staffId]||{};
  const [dragStart,setDragStart]=useState(null);
  const [selectDay,setSelectDay]=useState(null);

  if(!staff)return React.createElement("div",{style:{padding:20}},"ã‚¹ã‚¿ãƒƒãƒ•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");

  function setDayRequest(dk,start,end){
    updateRequest(staffId,dk,start&&end?{start,end}:null);
  }

  return React.createElement("div",{style:{minHeight:"100vh",background:C.bg}},
    React.createElement(Wrap,null,
      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:14,flexWrap:"wrap"}},
        React.createElement(BackBtn,{onClick:()=>setMode("nameInput")}),
        React.createElement(MonthNav,{year:props.year,month:props.month,setYear:props.setYear,setMonth:props.setMonth}),
        React.createElement("span",{style:{marginLeft:"auto",fontWeight:700,color:C.primary,fontSize:13}},staff.name+" ã•ã‚“"),
      ),
      React.createElement(DeadlineBanner,{deadline}),
      React.createElement("div",{style:{...card}},
        React.createElement("div",{style:{fontSize:12,color:C.muted,marginBottom:14}},"å„æ—¥ã®å‡ºå‹¤å¯èƒ½ãªé–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ã‚’é¸ã‚“ã§ãã ã•ã„ï¼ˆ30åˆ†åˆ»ã¿ï¼‰"),
        React.createElement("div",{style:{overflowX:"auto"}},
          React.createElement("table",{style:{borderCollapse:"collapse",width:"100%",fontSize:12}},
            React.createElement("thead",null,
              React.createElement("tr",null,
                React.createElement("th",{style:{...th,textAlign:"left",minWidth:36}},"æ—¥"),
                React.createElement("th",{style:th},"æ›œ"),
                React.createElement("th",{style:{...th,minWidth:100}},"é–‹å§‹"),
                React.createElement("th",{style:{...th,minWidth:100}},"çµ‚äº†"),
                React.createElement("th",{style:{...th,minWidth:60}},"æ™‚é–“"),
                React.createElement("th",{style:{...th,minWidth:60}},"æ“ä½œ"),
              )
            ),
            React.createElement("tbody",null,
              days.map(({day,wd,isRed,dk,holidayName})=>{
                const req=myReq[dk];
                const hours=req?calcHours(req.start,req.end):0;
                const rowBg=isRed?"#fdf0ee":"transparent";
                return React.createElement("tr",{key:dk,style:{background:rowBg}},
                  React.createElement("td",{style:{...td,fontWeight:700,color:isRed?C.rose:C.text},title:holidayName||""},day+(isRed&&holidayName?"ğŸŒ":"")),
                  React.createElement("td",{style:{...td,color:isRed?C.rose:C.muted}},wd),
                  React.createElement("td",{style:td},
                    React.createElement("select",{style:{...inp,padding:"4px 6px",width:90},value:req?.start||"",
                      onChange:e=>setDayRequest(dk,e.target.value,req?.end||"")},
                      React.createElement("option",{value:""},"--"),
                      SLOTS.map(s=>React.createElement("option",{key:s,value:s},s))
                    )
                  ),
                  React.createElement("td",{style:td},
                    React.createElement("select",{style:{...inp,padding:"4px 6px",width:90},value:req?.end||"",
                      onChange:e=>setDayRequest(dk,req?.start||"",e.target.value)},
                      React.createElement("option",{value:""},"--"),
                      SLOTS.filter(s=>!req?.start||slotToMinutes(s)>slotToMinutes(req.start))
                        .map(s=>React.createElement("option",{key:s,value:s},s)),
                      React.createElement("option",{value:"18:00"},"18:00")
                    )
                  ),
                  React.createElement("td",{style:{...td,color:hours>0?C.sage:C.faint,fontWeight:hours>0?700:400}},
                    hours>0?hours+"h":"â€”"
                  ),
                  React.createElement("td",{style:td},
                    req&&React.createElement("button",{style:btn(C.rose,false,true),onClick:()=>setDayRequest(dk,null,null)},"âœ•")
                  ),
                );
              })
            )
          )
        ),
        React.createElement("div",{style:{marginTop:12,fontSize:11,color:C.faint}},"âœ“ è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™")
      )
    )
  );
}

// ==================== ADMIN LOGIN ====================
function AdminLogin({setMode,adminOk,setAdminOk}){
  const [pw,setPw]=useState("");
  const [err,setErr]=useState("");
  if(adminOk){setMode("admin");return null;}
  return React.createElement("div",{style:{minHeight:"100vh",background:C.bg}},
    React.createElement(Wrap,null,
      React.createElement(BackBtn,{onClick:()=>setMode("home")}),
      React.createElement("div",{style:{...card,maxWidth:360}},
        React.createElement("div",{style:{fontWeight:800,fontSize:16,marginBottom:16}},"ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³"),
        React.createElement("input",{style:inp,type:"password",placeholder:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",value:pw,
          onChange:e=>setPw(e.target.value),
          onKeyDown:e=>{if(e.key==="Enter"){if(pw===ADMIN_PW){setAdminOk(true);setMode("admin");}else setErr("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");}}}),
        err&&React.createElement("div",{style:{color:C.rose,fontSize:12,marginTop:6}},err),
        React.createElement("button",{style:{...btn(C.sage),marginTop:12,width:"100%"},
          onClick:()=>{if(pw===ADMIN_PW){setAdminOk(true);setMode("admin");}else setErr("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");}},"ãƒ­ã‚°ã‚¤ãƒ³"),
        React.createElement("div",{style:{fontSize:11,color:C.faint,marginTop:8}},"åˆæœŸPW: admin1234")
      )
    )
  );
}

// ==================== ADMIN PANEL ====================
function AdminPanel(props){
  const {setMode,setAdminOk,mk,days,staffList,saveStaff,requests,shifts,year,month,setYear,setMonth,
    savePublished,saveDeadline,updateShift,isShortfall,staffMonthStats,
    published,deadline,fullDeadline,fullPublished}=props;
  const [tab,setTab]=useState("calendar");
  const [saveMsg,setSaveMsg]=useState("");
  const [selectedDay,setSelectedDay]=useState(null); // dk
  const [dlInput,setDlInput]=useState(deadline||"");

  useEffect(()=>setDlInput(deadline||""),[deadline,mk]);

  function doSave(msg="âœ“"){setSaveMsg(msg);setTimeout(()=>setSaveMsg(""),1800);}

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ãƒ–
  function CalendarTab(){
    // æœˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆ7åˆ—ã‚°ãƒªãƒƒãƒ‰ï¼‰
    const firstDow=new Date(year,month,1).getDay();
    const cells=[];
    for(let i=0;i<firstDow;i++)cells.push(null);
    days.forEach(d=>cells.push(d));
    while(cells.length%7!==0)cells.push(null);

    return React.createElement("div",null,
      React.createElement("div",{style:{fontSize:12,color:C.muted,marginBottom:12}},"æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚·ãƒ•ãƒˆã‚’ç·¨é›†ã€€",
        React.createElement("span",{style:{display:"inline-block",width:10,height:10,background:C.shortfall,border:`1px solid ${C.rose}`,borderRadius:2,marginRight:4}}),
        "å¿…è¦äººæ•°ä¸è¶³"
      ),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:4}},
        ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map(w=>
          React.createElement("div",{key:w,style:{textAlign:"center",fontSize:11,fontWeight:700,color:w==="æ—¥"||w==="åœŸ"?C.rose:C.muted,padding:"4px 0"}},w)
        ),
        cells.map((cell,i)=>{
          if(!cell)return React.createElement("div",{key:"e"+i});
          const {day,dk,isRed,isHoliday,holidayName}=cell;
          const dayShift=shifts[dk]||{};
          const assigned=Object.keys(dayShift.assigned||{}).length;
          const required=(dayShift.positions||[]).reduce((s,p)=>s+(p.required||0),0);
          const shortage=isShortfall(dk);
          const hasData=assigned>0||required>0;
          return React.createElement("div",{key:dk,
            onClick:()=>setSelectedDay(dk),
            style:{
              background:shortage?C.shortfall:isRed?"#fdf0ee":C.card,
              border:`1.5px solid ${selectedDay===dk?C.primary:shortage?C.rose:C.border}`,
              borderRadius:10,padding:"6px 4px",cursor:"pointer",minHeight:64,
              transition:"border-color .15s",position:"relative",
            }},
            React.createElement("div",{style:{fontWeight:700,fontSize:13,color:isRed?C.rose:C.text}},day,(isHoliday?"ğŸŒ":"")),
            hasData&&React.createElement("div",{style:{fontSize:10,color:shortage?C.rose:C.sage,marginTop:2}},
              assigned+"/"+required+"äºº"
            ),
            required>0&&React.createElement("div",{style:{fontSize:9,color:C.muted,marginTop:1}},
              (dayShift.positions||[]).map(p=>p.name).join(" ")
            ),
          );
        })
      ),
      selectedDay&&React.createElement(DayEditor,{dk:selectedDay,shifts,updateShift,staffList,requests,doSave,onClose:()=>setSelectedDay(null)})
    );
  }

  // ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ã‚¿ãƒ–
  function StaffTab(){
    const [nName,setNName]=useState("");
    const [nWage,setNWage]=useState("");
    const [nTarget,setNTarget]=useState("");
    return React.createElement("div",null,
      React.createElement("div",{style:{fontWeight:700,marginBottom:14}},"ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§"),
      staffList.length===0&&React.createElement("div",{style:{color:C.muted,fontSize:13,marginBottom:16}},"ã‚¹ã‚¿ãƒƒãƒ•ãŒã„ã¾ã›ã‚“"),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:20}},
        staffList.map(s=>{
          const {totalHours,totalPay}=staffMonthStats(s.id);
          return React.createElement("div",{key:s.id,style:{...card,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap",padding:"12px 16px"}},
            React.createElement("div",{style:{flex:1,minWidth:80}},
              React.createElement("div",{style:{fontWeight:700,fontSize:14}},s.name),
              React.createElement("div",{style:{fontSize:11,color:C.muted}},`æ™‚çµ¦ ${s.hourlyWage||0}å†† / ç›®æ¨™ ${s.targetHours||0}h`),
            ),
            React.createElement("div",{style:{fontSize:12,color:C.text,textAlign:"right"}},
              React.createElement("div",null,`${year}/${month+1}: `,React.createElement("b",null,totalHours.toFixed(1)+"h")),
              React.createElement("div",{style:{color:C.primary,fontWeight:700}},totalPay.toLocaleString()+"å††"),
              s.targetHours>0&&React.createElement("div",{style:{fontSize:10,color:totalHours>=s.targetHours?C.sage:C.amber}},
                `ç›®æ¨™ ${s.targetHours}h ${totalHours>=s.targetHours?"âœ“é”æˆ":"(æœªé”)"}`)
            ),
            React.createElement("div",{style:{display:"flex",gap:6}},
              React.createElement("button",{style:btn(C.rose,false,true),
                onClick:()=>{if(window.confirm(`ã€Œ${s.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))saveStaff(staffList.filter(x=>x.id!==s.id));}
              },"å‰Šé™¤"),
            )
          );
        })
      ),
      React.createElement("div",{style:{fontWeight:700,marginBottom:10,fontSize:13}},"ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ "),
      React.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"flex-end"}},
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:11,color:C.muted,marginBottom:4}},"åå‰"),
          React.createElement("input",{style:{...inp,width:120},placeholder:"åå‰",value:nName,onChange:e=>setNName(e.target.value)})
        ),
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:11,color:C.muted,marginBottom:4}},"æ™‚çµ¦ï¼ˆå††ï¼‰"),
          React.createElement("input",{style:{...inp,width:90},placeholder:"1000",type:"number",value:nWage,onChange:e=>setNWage(e.target.value)})
        ),
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:11,color:C.muted,marginBottom:4}},"æœˆç›®æ¨™æ™‚é–“"),
          React.createElement("input",{style:{...inp,width:90},placeholder:"80",type:"number",value:nTarget,onChange:e=>setNTarget(e.target.value)})
        ),
        React.createElement("button",{style:btn(C.primary),
          onClick:()=>{
            if(!nName.trim())return;
            saveStaff([...staffList,{id:Date.now().toString(),name:nName.trim(),hourlyWage:Number(nWage)||0,targetHours:Number(nTarget)||0}]);
            setNName("");setNWage("");setNTarget("");
          }
        },"è¿½åŠ "),
      )
    );
  }

  // å¸Œæœ›ä¸€è¦§ã‚¿ãƒ–
  function RequestsTab(){
    return React.createElement("div",null,
      React.createElement("div",{style:{fontSize:12,color:C.muted,marginBottom:14}},"ã‚¹ã‚¿ãƒƒãƒ•ã®å¸Œæœ›æ™‚é–“ä¸€è¦§"),
      staffList.length===0&&React.createElement("div",{style:{color:C.muted,fontSize:13}},"ã‚¹ã‚¿ãƒƒãƒ•ãŒã„ã¾ã›ã‚“"),
      staffList.map(s=>{
        const myReq=requests[s.id]||{};
        const submitted=Object.entries(myReq).filter(([dk,v])=>v&&dk.startsWith(mk.slice(0,7)));
        const totalH=submitted.reduce((sum,[,v])=>sum+calcHours(v.start,v.end),0);
        return React.createElement("div",{key:s.id,style:{marginBottom:20}},
          React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6}},
            React.createElement("span",{style:{fontWeight:700,color:C.primary,fontSize:14}},s.name),
            React.createElement("span",{style:{fontSize:11,color:C.muted}},`${submitted.length}æ—¥ / åˆè¨ˆ${totalH.toFixed(1)}h`),
            submitted.length===0&&React.createElement("span",{style:{fontSize:11,color:C.amber,background:C.amberLight,padding:"1px 8px",borderRadius:10}},"æœªå…¥åŠ›"),
          ),
          submitted.length>0&&React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6}},
            submitted.sort(([a],[b])=>a.localeCompare(b)).map(([dk,v])=>{
              const d=new Date(dk);
              const wds=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][d.getDay()];
              const isRed=d.getDay()===0||d.getDay()===6||!!holidays[dk];
              return React.createElement("div",{key:dk,style:{padding:"3px 10px",borderRadius:8,background:C.card,border:`1px solid ${C.border}`,fontSize:11}},
                React.createElement("span",{style:{color:isRed?C.rose:C.muted,fontWeight:700}},`${d.getDate()}(${wds}) `),
                React.createElement("span",{style:{color:C.text}},`${v.start}ã€œ${v.end} `),
                React.createElement("span",{style:{color:C.sage,fontWeight:700}},calcHours(v.start,v.end)+"h"),
              );
            })
          )
        );
      })
    );
  }

  // è¨­å®šã‚¿ãƒ–
  function SettingsTab(){
    return React.createElement("div",null,
      React.createElement("div",{style:{fontWeight:700,marginBottom:16}},"æœˆæ¬¡è¨­å®š"),
      React.createElement("div",{style:{marginBottom:20}},
        React.createElement("div",{style:{fontSize:12,color:C.muted,marginBottom:6}},"å¸Œæœ›ç· åˆ‡æ—¥"),
        React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center"}},
          React.createElement("input",{type:"date",style:{...inp,width:"auto"},value:dlInput,onChange:e=>setDlInput(e.target.value)}),
          React.createElement("button",{style:btn(C.primary,false,true),onClick:()=>{saveDeadline({...fullDeadline,[mk]:dlInput});doSave();}},"ä¿å­˜"),
          dlInput&&React.createElement("button",{style:btn(C.faint,false,true),onClick:()=>{setDlInput("");saveDeadline({...fullDeadline,[mk]:""});}},"ã‚¯ãƒªã‚¢"),
        )
      ),
    );
  }

  return React.createElement("div",{style:{minHeight:"100vh",background:C.bg}},
    React.createElement(Wrap,null,
      // ãƒ˜ãƒƒãƒ€ãƒ¼
      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:16,flexWrap:"wrap"}},
        React.createElement("button",{style:{...btn(C.faint,true,true)},onClick:()=>{setAdminOk(false);setMode("home");}},"â† ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"),
        React.createElement(MonthNav,{year,month,setYear,setMonth}),
        saveMsg&&React.createElement("span",{style:{fontSize:12,color:C.sage}},saveMsg),
        React.createElement("div",{style:{marginLeft:"auto",display:"flex",gap:8}},
          published
            ?React.createElement("button",{style:btn(C.rose),onClick:()=>{savePublished({...fullPublished,[mk]:false});doSave("å…¬é–‹å–æ¶ˆ");}}, "å…¬é–‹å–æ¶ˆ")
            :React.createElement("button",{style:btn(C.sage),onClick:()=>{savePublished({...fullPublished,[mk]:true});doSave("å…¬é–‹ã—ã¾ã—ãŸï¼");}}, "âœ“ å…¬é–‹ã™ã‚‹"),
          React.createElement("button",{style:btn(C.faint),onClick:()=>handlePrint(props)},"ğŸ–¨ å°åˆ·"),
        )
      ),
      published&&React.createElement("div",{style:{padding:"6px 14px",borderRadius:8,background:C.sageLight,border:`1px solid ${C.sage}44`,fontSize:12,color:C.sage,marginBottom:12}},"âœ“ ã“ã®ã‚·ãƒ•ãƒˆã¯å…¬é–‹ä¸­ã§ã™"),

      // ã‚¿ãƒ–
      React.createElement("div",{style:{display:"flex",gap:6,marginBottom:16,flexWrap:"wrap"}},
        [["calendar","ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"],["requests","ğŸ“‹ å¸Œæœ›ä¸€è¦§"],["staff","ğŸ‘¥ ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†"],["settings","âš™ è¨­å®š"]].map(([k,l])=>
          React.createElement("button",{key:k,style:{...btn(tab===k?C.primary:C.faint,tab!==k,true),padding:"6px 14px",fontSize:12},onClick:()=>setTab(k)},l)
        )
      ),

      React.createElement("div",{style:card},
        tab==="calendar"&&React.createElement(CalendarTab),
        tab==="requests"&&React.createElement(RequestsTab),
        tab==="staff"&&React.createElement(StaffTab),
        tab==="settings"&&React.createElement(SettingsTab),
      )
    )
  );
}

// ==================== DAY EDITOR (ãƒ¢ãƒ¼ãƒ€ãƒ«) ====================
function DayEditor({dk,shifts,updateShift,staffList,requests,doSave,onClose}){
  const dayShift=shifts[dk]||{positions:[],assigned:{}};
  const [positions,setPositions]=useState(dayShift.positions||[]);
  const [assigned,setAssigned]=useState(dayShift.assigned||{});
  const [newPosName,setNewPosName]=useState("");
  const [newPosReq,setNewPosReq]=useState(1);

  const d=new Date(dk);
  const wds=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][d.getDay()];
  const label=`${d.getMonth()+1}/${d.getDate()}(${wds})`;

  // ãã®æ—¥ã«å¸Œæœ›ã‚’å‡ºã—ãŸã‚¹ã‚¿ãƒƒãƒ•
  const availableStaff=staffList.filter(s=>{
    const r=(requests[s.id]||{})[dk];
    return r&&r.start&&r.end;
  });

  function save(){
    updateShift(dk,{positions,assigned});
    doSave();
  }

  function addPosition(){
    if(!newPosName.trim())return;
    setPositions([...positions,{name:newPosName.trim(),required:newPosReq}]);
    setNewPosName("");setNewPosReq(1);
  }
  function removePosition(i){
    setPositions(positions.filter((_,j)=>j!==i));
  }
  function assignStaff(staffId,field,val){
    setAssigned(prev=>({...prev,[staffId]:{...(prev[staffId]||{}), [field]:val}}));
  }
  function removeAssign(staffId){
    setAssigned(prev=>{const n={...prev};delete n[staffId];return n;});
  }

  const totalRequired=positions.reduce((s,p)=>s+(p.required||0),0);
  const totalAssigned=Object.keys(assigned).length;
  const shortage=totalAssigned<totalRequired;

  return React.createElement("div",{className:"modal-overlay",onClick:e=>{if(e.target===e.currentTarget)onClose();}},
    React.createElement("div",{className:"modal"},
      // ãƒ˜ãƒƒãƒ€ãƒ¼
      React.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:20}},
        React.createElement("div",{style:{fontWeight:800,fontSize:18,fontFamily:"'Shippori Mincho',serif"}},label," ã‚·ãƒ•ãƒˆç·¨é›†"),
        React.createElement("button",{style:{marginLeft:"auto",...btn(C.faint,true,true)},onClick:onClose},"âœ• é–‰ã˜ã‚‹"),
      ),

      // ãƒã‚¸ã‚·ãƒ§ãƒ³è¨­å®š
      React.createElement("div",{style:{marginBottom:20}},
        React.createElement("div",{style:{fontWeight:700,fontSize:13,marginBottom:10,color:C.text}},"ğŸ“Œ ãƒã‚¸ã‚·ãƒ§ãƒ³è¨­å®š"),
        positions.length===0&&React.createElement("div",{style:{fontSize:12,color:C.muted,marginBottom:8}},"ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“"),
        positions.map((p,i)=>
          React.createElement("div",{key:i,style:{display:"flex",gap:8,alignItems:"center",marginBottom:6,padding:"6px 10px",background:"#fdf5ef",borderRadius:8,border:`1px solid ${C.border}`}},
            React.createElement("span",{style:{flex:1,fontWeight:700,fontSize:13}},p.name),
            React.createElement("span",{style:{fontSize:12,color:C.muted}},`å¿…è¦ `),
            React.createElement("input",{type:"number",min:1,max:10,style:{...inp,width:50,padding:"3px 6px"},value:p.required,
              onChange:e=>setPositions(positions.map((x,j)=>j===i?{...x,required:Number(e.target.value)||1}:x))}),
            React.createElement("span",{style:{fontSize:12,color:C.muted}},"äºº"),
            React.createElement("button",{style:btn(C.rose,false,true),onClick:()=>removePosition(i)},"âœ•"),
          )
        ),
        React.createElement("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",marginTop:8}},
          React.createElement("input",{style:{...inp,width:130},placeholder:"ãƒã‚¸ã‚·ãƒ§ãƒ³åï¼ˆä¾‹:çª“å£ï¼‰",value:newPosName,onChange:e=>setNewPosName(e.target.value),
            onKeyDown:e=>{if(e.key==="Enter")addPosition();}}),
          React.createElement("input",{type:"number",min:1,max:10,style:{...inp,width:60,padding:"6px 8px"},value:newPosReq,
            onChange:e=>setNewPosReq(Number(e.target.value)||1)}),
          React.createElement("span",{style:{fontSize:12,color:C.muted}},"äºº"),
          React.createElement("button",{style:btn(C.primary,false,true),onClick:addPosition},"+ è¿½åŠ "),
        )
      ),

      // ã‚¹ã‚¿ãƒƒãƒ•å‰²ã‚Šå½“ã¦
      React.createElement("div",{style:{marginBottom:20}},
        React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:10}},
          React.createElement("div",{style:{fontWeight:700,fontSize:13,color:C.text}},"ğŸ‘¤ ã‚¹ã‚¿ãƒƒãƒ•å‰²ã‚Šå½“ã¦"),
          React.createElement("span",{style:{fontSize:11,padding:"2px 8px",borderRadius:10,
            background:shortage?C.roseLight:C.sageLight,color:shortage?C.rose:C.sage,fontWeight:700}},
            `${totalAssigned}/${totalRequired}äºº`
          ),
        ),

        // å¸Œæœ›ã‚’å‡ºã—ãŸã‚¹ã‚¿ãƒƒãƒ•
        availableStaff.length===0&&React.createElement("div",{style:{fontSize:12,color:C.muted,marginBottom:8}},"ã“ã®æ—¥ã«å¸Œæœ›ã‚’å‡ºã—ãŸã‚¹ã‚¿ãƒƒãƒ•ãŒã„ã¾ã›ã‚“"),
        availableStaff.map(s=>{
          const req=(requests[s.id]||{})[dk];
          const a=assigned[s.id];
          const isAssigned=!!a;
          return React.createElement("div",{key:s.id,style:{
            padding:"8px 12px",borderRadius:10,marginBottom:6,
            background:isAssigned?C.primaryLight:"#fdf8f3",
            border:`1px solid ${isAssigned?C.primary:C.border}`,
            display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",
          }},
            React.createElement("div",{style:{flex:1,minWidth:80}},
              React.createElement("div",{style:{fontWeight:700,fontSize:13}},s.name),
              React.createElement("div",{style:{fontSize:11,color:C.muted}},`å¸Œæœ›: ${req.start}ã€œ${req.end} (${calcHours(req.start,req.end)}h)`),
            ),
            isAssigned&&React.createElement("select",{style:{...inp,width:120,padding:"4px 6px"},value:a.position||"",
              onChange:e=>assignStaff(s.id,"position",e.target.value)},
              React.createElement("option",{value:""},"ãƒã‚¸ã‚·ãƒ§ãƒ³é¸æŠ"),
              positions.map(p=>React.createElement("option",{key:p.name,value:p.name},p.name))
            ),
            isAssigned&&React.createElement("div",{style:{display:"flex",gap:4,alignItems:"center"}},
              React.createElement("select",{style:{...inp,width:80,padding:"4px 6px"},value:a.start||req.start,onChange:e=>assignStaff(s.id,"start",e.target.value)},
                SLOTS.map(sl=>React.createElement("option",{key:sl,value:sl},sl))
              ),
              React.createElement("span",{style:{fontSize:11,color:C.muted}},"ã€œ"),
              React.createElement("select",{style:{...inp,width:80,padding:"4px 6px"},value:a.end||req.end,onChange:e=>assignStaff(s.id,"end",e.target.value)},
                SLOTS.filter(sl=>!a?.start||slotToMinutes(sl)>slotToMinutes(a.start||req.start))
                  .map(sl=>React.createElement("option",{key:sl,value:sl},sl)),
                React.createElement("option",{value:"18:00"},"18:00")
              ),
            ),
            React.createElement("button",{
              style:btn(isAssigned?C.rose:C.primary,false,true),
              onClick:()=>isAssigned?removeAssign(s.id):setAssigned(prev=>({...prev,[s.id]:{position:"",start:req.start,end:req.end}}))
            },isAssigned?"å¤–ã™":"å‰²å½“"),
          );
        }),

        // å¸Œæœ›ãªã—ã‚¹ã‚¿ãƒƒãƒ•ã‚‚è¿½åŠ å¯èƒ½
        staffList.filter(s=>!availableStaff.find(a=>a.id===s.id)).length>0&&
          React.createElement("details",{style:{marginTop:8}},
            React.createElement("summary",{style:{fontSize:11,color:C.muted,cursor:"pointer"}},"å¸Œæœ›ãªã—ã‚¹ã‚¿ãƒƒãƒ•ã‚‚è¿½åŠ ã™ã‚‹"),
            React.createElement("div",{style:{paddingTop:8}},
              staffList.filter(s=>!availableStaff.find(a=>a.id===s.id)).map(s=>{
                const a=assigned[s.id];
                const isAssigned=!!a;
                return React.createElement("div",{key:s.id,style:{padding:"6px 12px",borderRadius:8,marginBottom:4,background:"#fdf8f3",border:`1px solid ${C.border}`,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}},
                  React.createElement("span",{style:{flex:1,fontWeight:700,fontSize:12}},s.name),
                  isAssigned&&React.createElement("select",{style:{...inp,width:120,padding:"4px 6px"},value:a.position||"",onChange:e=>assignStaff(s.id,"position",e.target.value)},
                    React.createElement("option",{value:""},"ãƒã‚¸ã‚·ãƒ§ãƒ³é¸æŠ"),
                    positions.map(p=>React.createElement("option",{key:p.name,value:p.name},p.name))
                  ),
                  isAssigned&&React.createElement("div",{style:{display:"flex",gap:4,alignItems:"center"}},
                    React.createElement("select",{style:{...inp,width:80,padding:"4px 6px"},value:a.start||SLOTS[0],onChange:e=>assignStaff(s.id,"start",e.target.value)},
                      SLOTS.map(sl=>React.createElement("option",{key:sl,value:sl},sl))
                    ),
                    React.createElement("span",{style:{fontSize:11,color:C.muted}},"ã€œ"),
                    React.createElement("select",{style:{...inp,width:80,padding:"4px 6px"},value:a.end||SLOTS[SLOTS.length-1],onChange:e=>assignStaff(s.id,"end",e.target.value)},
                      SLOTS.filter(sl=>slotToMinutes(sl)>slotToMinutes(a.start||SLOTS[0]))
                        .map(sl=>React.createElement("option",{key:sl,value:sl},sl)),
                      React.createElement("option",{value:"18:00"},"18:00")
                    ),
                  ),
                  React.createElement("button",{style:btn(isAssigned?C.rose:C.faint,false,true),
                    onClick:()=>isAssigned?removeAssign(s.id):setAssigned(prev=>({...prev,[s.id]:{position:"",start:SLOTS[0],end:"18:00"}}))}
                  ,isAssigned?"å¤–ã™":"è¿½åŠ "),
                );
              })
            )
          )
      ),

      // ä¿å­˜ãƒœã‚¿ãƒ³
      React.createElement("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"}},
        React.createElement("button",{style:btn(C.faint,true),onClick:onClose},"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"),
        React.createElement("button",{style:btn(C.primary),onClick:save},"ğŸ’¾ ä¿å­˜"),
      )
    )
  );
}

// ==================== å°åˆ· ====================
function handlePrint(props){
  const {days,shifts,staffList,mk,year,month,deadline,staffMonthStats}=props;
  const names=staffList.map(s=>s.name);
  const html=`<!DOCTYPE html><html><head><meta charset="utf-8">
<title>${year}å¹´${month+1}æœˆ ã‚·ãƒ•ãƒˆè¡¨</title>
<style>
body{font-family:'Hiragino Kaku Gothic ProN','Meiryo',sans-serif;padding:20px;color:#1e293b;font-size:11px;}
h1{font-size:16px;margin-bottom:4px;}
.dl{font-size:10px;color:#64748b;margin-bottom:12px;}
table{border-collapse:collapse;width:100%;}
th{background:#7a6055;color:#fff;padding:5px 4px;text-align:center;font-size:10px;}
td{border:1px solid #e2e8f0;padding:3px;text-align:center;font-size:10px;}
.red{color:#c47a7a;font-weight:bold;}
.we{background:#fff0ee;}
.short{background:#fde8e8;}
.chip{display:inline-block;padding:1px 4px;border-radius:3px;font-size:9px;font-weight:bold;background:#e0f2fe;color:#0369a1;}
.summary{margin-top:16px;}
.summary table{max-width:500px;}
</style></head><body>
<h1>${year}å¹´${month+1}æœˆ ã‚·ãƒ•ãƒˆè¡¨</h1>
${deadline?`<div class="dl">å¸Œæœ›ç· åˆ‡ï¼š${deadline}</div>`:""}
<table>
<tr><th>æ—¥</th><th>æ›œ</th><th>ãƒã‚¸ã‚·ãƒ§ãƒ³</th>${names.map(n=>`<th>${n}</th>`).join("")}</tr>
${days.map(({day,wd,isRed,isHoliday,dk})=>{
  const ds=shifts[dk]||{};
  const pos=(ds.positions||[]).map(p=>p.name+"Ã—"+p.required).join(" ");
  const assigned=ds.assigned||{};
  const totalR=(ds.positions||[]).reduce((s,p)=>s+(p.required||0),0);
  const totalA=Object.keys(assigned).length;
  const short=totalA<totalR&&totalR>0;
  return `<tr class="${isRed?"we":""}${short?" short":""}">
<td class="${isRed?"red":""}" style="font-weight:bold">${day}${isHoliday?"*":""}</td>
<td class="${isRed?"red":""}">${wd}</td>
<td style="font-size:9px;color:#666">${pos||""}</td>
${staffList.map(s=>{const a=assigned[s.id];return`<td>${a?`<span class="chip">${a.position||""}</span><br>${a.start}ã€œ${a.end}`:""}</td>`;}).join("")}
</tr>`;}).join("")}
</table>
<div class="summary">
<h2 style="font-size:12px;margin-bottom:6px">å‹¤å‹™æ™‚é–“ã‚µãƒãƒªãƒ¼</h2>
<table><tr><th>åå‰</th><th>æ™‚é–“</th><th>çµ¦ä¸</th><th>ç›®æ¨™</th></tr>
${staffList.map(s=>{const{totalHours,totalPay}=staffMonthStats(s.id);return`<tr><td>${s.name}</td><td>${totalHours.toFixed(1)}h</td><td>${totalPay.toLocaleString()}å††</td><td>${s.targetHours||0}h</td></tr>`;}).join("")}
</table></div>
<p style="font-size:9px;color:#94a3b8;margin-top:10px">å‡ºåŠ›æ—¥ï¼š${new Date().toLocaleDateString("ja-JP")}</p>
</body></html>`;
  const w=window.open("","_blank");
  w.document.write(html);w.document.close();
  setTimeout(()=>{w.focus();w.print();},500);
}

// ==================== å…¬é–‹ãƒ“ãƒ¥ãƒ¼ ====================
function PublicView(props){
  const {setMode,mk,days,shifts,staffList,published,staffMonthStats,year,month,setYear,setMonth}=props;

  return React.createElement("div",{style:{minHeight:"100vh",background:C.bg}},
    React.createElement(Wrap,null,
      React.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:14,flexWrap:"wrap"}},
        React.createElement(BackBtn,{onClick:()=>setMode("home")}),
        React.createElement(MonthNav,{year,month,setYear,setMonth}),
      ),
      !published
        ?React.createElement("div",{style:{...card,textAlign:"center",padding:"48px 20px"}},
            React.createElement("div",{style:{fontSize:32,marginBottom:8}},"â³"),
            React.createElement("div",{style:{color:C.muted}},"ã‚·ãƒ•ãƒˆã¯ã¾ã å…¬é–‹ã•ã‚Œã¦ã„ã¾ã›ã‚“")
          )
        :React.createElement("div",null,
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼
            React.createElement("div",{style:{...card,marginBottom:16}},
              React.createElement("div",{style:{fontWeight:700,marginBottom:12}},`${year}å¹´${month+1}æœˆ ç¢ºå®šã‚·ãƒ•ãƒˆ`),
              React.createElement("div",{style:{overflowX:"auto"}},
                React.createElement("table",{style:{borderCollapse:"collapse",width:"100%",fontSize:12,minWidth:500}},
                  React.createElement("thead",null,
                    React.createElement("tr",null,
                      React.createElement("th",{style:{...th,textAlign:"left"}},"æ—¥"),
                      React.createElement("th",{style:th},"æ›œ"),
                      staffList.map(s=>React.createElement("th",{key:s.id,style:th},s.name))
                    )
                  ),
                  React.createElement("tbody",null,
                    days.map(({day,wd,isRed,isHoliday,dk,holidayName})=>{
                      const ds=shifts[dk]||{};
                      const assigned=ds.assigned||{};
                      return React.createElement("tr",{key:dk,style:{background:isRed?"#fdf0ee":"transparent"}},
                        React.createElement("td",{style:{...td,fontWeight:700,color:isRed?C.rose:C.text},title:holidayName||""},day+(isHoliday?"ğŸŒ":"")),
                        React.createElement("td",{style:{...td,color:isRed?C.rose:C.muted}},wd),
                        staffList.map(s=>{
                          const a=assigned[s.id];
                          return React.createElement("td",{key:s.id,style:td},
                            a?React.createElement("div",null,
                              a.position&&React.createElement("div",{style:{fontSize:10,fontWeight:700,color:C.primary,background:C.primaryLight,borderRadius:4,padding:"1px 4px",marginBottom:1}},a.position),
                              React.createElement("div",{style:{fontSize:10,color:C.muted}},`${a.start}ã€œ${a.end}`)
                            ):React.createElement("span",{style:{color:"#e0d5cc"}},"â€”")
                          );
                        })
                      );
                    })
                  )
                )
              )
            ),
            // å‹¤å‹™æ™‚é–“ã‚µãƒãƒªãƒ¼ï¼ˆå…¬é–‹ç”¨ï¼šæ™‚é–“ã®ã¿ã€çµ¦ä¸ãƒ»æ™‚çµ¦ãªã—ï¼‰
            React.createElement("div",{style:card},
              React.createElement("div",{style:{fontWeight:700,marginBottom:12}},"å‹¤å‹™æ™‚é–“ã‚µãƒãƒªãƒ¼"),
              React.createElement("div",{style:{display:"flex",gap:10,flexWrap:"wrap"}},
                staffList.map(s=>{
                  const {totalHours}=staffMonthStats(s.id);
                  return React.createElement("div",{key:s.id,style:{padding:"8px 16px",borderRadius:10,background:C.card,border:`1px solid ${C.border}`,textAlign:"center",minWidth:80}},
                    React.createElement("div",{style:{fontWeight:700,fontSize:13}},s.name),
                    React.createElement("div",{style:{fontSize:18,fontWeight:800,color:C.primary,marginTop:2}},totalHours.toFixed(1)),
                    React.createElement("div",{style:{fontSize:10,color:C.muted}},"æ™‚é–“"),
                  );
                })
              )
            )
          )
    )
  );
}



ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
